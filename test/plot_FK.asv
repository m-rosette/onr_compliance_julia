% Plotting Forward Kinematics
% Marcus Rosette
% 01/27/2023

file = load("Collision Data Storage\planar_arm_workspace_data - Copy.mat");

% Import robot URDF
robot = importrobot('bravo7_planar.urdf', DataFormat='column');

end_points = zeros(200);
transform = getTransform(robot, [pi; pi; pi], "world", "bravo_finger_jaws_rs2_301_link");
ee_point = transform(1:3, 4)';
figure;
show(robot, [pi; pi; pi], "Visuals","off")
hold on 
scatter3(ee_point(3), ee_point(2), -ee_point(1), ".", "s")



% figure;
% show(robot, [pi; pi; pi])
% hold on 
% scatter3(-file.file.ee_points(:, 1)/1000, file.file.ee_points(:, 2), file.file.ee_points(:, 3)/1000, "."); % Converted mm to m
% % scatter(file.file.ee_points(:, 1)/1000, file.file.ee_points(:, 3)/1000, "."); % Converted mm to m
% xlim([-1.5, 1.5])
% zlim([-1.5, 1.5])
% title("Possible Bravo End-Effector Points")
% xlabel("x-axis (m)")
% ylabel("z-axis (m)")
% grid on
% set(gca, 'XDir','reverse')




% Found a repeated collision at index 7415
% More collisions found at index 13051
% More at index 501058
% IT SEEMS LIKE THE END EFFECTOR MESH IS NOT INCLUEDED IN THE COLLISION CHECK

% figure;
% test_window = 10000;
% for i = test_window:test_window+5000
%     show(robot, file.file.collision_free_angles(i, :)', 'PreservePlot', false, 'FastUpdate', true)
%     hold on
%     x = (-file.file.ee_points(i, 1)/1000) + 0.2;
%     y = 0;
%     z = (file.file.ee_points(i, 3)/1000) - 0.1;
%     scatter3(x, y, z, ".", "blue");
% %     scatter3(-file.file.ee_points(i, 1)/1000, 0, file.file.ee_points(i, 3)/1000, ".");
%     drawnow
% end
 
% show(robot, file.file.collision_free_angles(501058, :)', 'PreservePlot', false, 'FastUpdate', true)
